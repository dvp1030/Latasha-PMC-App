<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Uploaded Media</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <style>
        body {
            background-color: #f0f2f5; /* Light background for modern look */
            color: #333; /* Dark text color */
            font-family: 'Arial', sans-serif; /* Font style */
        }

        h1 {
            color: #007bff; /* Primary color for the header */
            font-weight: bold; /* Bold font for the heading */
            margin-bottom: 30px; /* Space below heading */
            text-align: center; /* Center align header */
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1); /* Subtle text shadow */
        }

        .media-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-around;
            margin: 0 -15px; /* Remove default margins for better spacing */
        }

        .media-item {
            width: 300px; /* Set a fixed width for the media items */
            margin: 15px; /* Add some margin for spacing */
            text-align: center; /* Center-align text and buttons */
            border: none; /* Remove border for cleaner look */
            border-radius: 10px; /* Rounded corners */
            overflow: hidden; /* Hide overflow */
            background-color: #ffffff; /* White background for items */
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2); /* Add a stronger shadow */
            transition: transform 0.3s, box-shadow 0.3s; /* Transition for smooth effects */
        }

        .media-item:hover {
            transform: translateY(-5px); /* Lift effect on hover */
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3); /* Deeper shadow on hover */
        }

        .media-item img,
        .media-item video {
            width: 100%; /* Make media elements responsive */
            height: auto; /* Maintain aspect ratio */
            border-bottom: 1px solid #ddd; /* Add a border below the media */
        }

        .media-body {
            padding: 15px; /* Add padding inside the media body */
        }

        .form-control {
            border-radius: 5px; /* Rounded corners for input */
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.2); /* Inset shadow for depth */
            transition: all 0.3s; /* Transition for smooth effects */
        }

        .form-control:focus {
            border-color: #007bff; /* Primary color on focus */
            box-shadow: 0 0 5px rgba(0, 123, 255, 0.5); /* Glow effect on focus */
            outline: none; /* Remove default outline */
        }

        button {
            font-weight: bold; /* Bold text for buttons */
            border-radius: 5px; /* Rounded corners for buttons */
            transition: all 0.3s; /* Transition for smooth effects */
        }

        button:hover {
            transform: translateY(-2px); /* Lift effect on hover */
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2); /* Deeper shadow on hover */
        }

        .btn-danger {
            background-color: #dc3545; /* Danger color for delete */
            border: none; /* Remove border */
        }

        .btn-danger:hover {
            background-color: #c82333; /* Darker shade on hover */
        }

        .btn-secondary {
            background-color: #6c757d; /* Secondary button color */
            border: none; /* Remove border */
        }

        .btn-secondary:hover {
            background-color: #5a6268; /* Darker shade on hover */
        }
    </style>
</head>

<body>
    <div class="container mt-5">
        <h1>Uploaded Media</h1>
        <div class="media-container">
            {% for media in media_list %}
                <div class="media-item">
                    {% if media.endswith('.mp4') or media.endswith('.avi') %}
                        <video controls alt="{{ media }}">
                            <source src="{{ url_for('static', filename='uploads/' + media) }}" type="video/mp4">
                            Your browser does not support the video tag.
                        </video>
                    {% else %}
                        <img src="{{ url_for('static', filename='uploads/' + media) }}" alt="{{ media }}">
                    {% endif %}
                    <div class="media-body">
                        <strong>{{ media }}</strong>
                        <input type="text" class="form-control mt-2" id="newFilename-{{ media }}" placeholder="Enter new filename">
                        <button class="btn btn-primary mt-1" onclick="editFilename('{{ media }}')">Save Changes</button>
                        <button class="btn btn-danger mt-1" onclick="confirmDelete('{{ media }}')">Delete</button>
                    </div>
                </div>
            {% endfor %}
        </div>
        <a href="{{ url_for('upload_media', project_id=project_id) }}" class="btn btn-secondary mt-3">Back to Upload</a>
    </div>

    <script>
        function editFilename(media) {
            const newFilename = document.getElementById(`newFilename-${media}`).value;

            if (!newFilename) {
                alert('Please enter a valid filename.');
                return;
            }

            $.post(`{{ url_for('edit_media', project_id=project_id) }}`, 
            { old_name: media, new_name: newFilename }, function(data) {
                if (data.success) {
                    alert('Filename updated successfully');
                    location.reload();  // Reload the page to see changes
                } else {
                    alert('Error updating filename: ' + data.error);
                }
            }).fail(function() {
                alert('Request failed. Please try again.');
            });
        }

        // Confirm delete and handle media deletion
        function confirmDelete(media) {
            if (confirm('Are you sure you want to delete this media?')) {
                $.post('{{ url_for('delete_media', project_id=project_id) }}', { media: media }, function(data) {
                    if (data.success) {
                        alert('Media deleted successfully');
                        location.reload();
                    } else {
                        alert('Error deleting media');
                    }
                });
            }
        }
    </script>
</body>

</html>
